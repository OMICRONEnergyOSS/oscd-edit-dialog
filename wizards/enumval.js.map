{"version":3,"file":"enumval.js","sources":["../../../wizards/enumval.ts"],"sourcesContent":["import { html, TemplateResult } from 'lit';\n\nimport { EditV2 } from '@omicronenergy/oscd-api';\nimport { getReference } from '@openenergytools/scl-lib';\n\nimport {\n  cloneElement,\n  createElement,\n  getValue,\n  Wizard,\n  WizardActor,\n  WizardInputElement,\n} from '../foundation.js';\nimport { patterns } from './patterns.js';\n\ntype EnumValContent = {\n  ord: string | null;\n  desc: string | null;\n  value: string | null;\n};\n\nfunction renderContent(content: EnumValContent): TemplateResult[] {\n  return [\n    html`<scl-text-field\n      label=\"ord\"\n      .value=${content.ord}\n      required\n      type=\"number\"\n    ></scl-text-field>`,\n    html`<scl-text-field\n      label=\"value\"\n      .value=${content.value}\n      pattern=\"${patterns.normalizedString}\"\n      dialogInitialFocus\n    ></scl-text-field>`,\n    html`<scl-text-field\n      id=\"evDesc\"\n      label=\"desc\"\n      .value=${content.desc}\n      nullable\n      pattern=\"${patterns.normalizedString}\"\n    ></scl-text-field>`,\n  ];\n}\n\nfunction nextOrd(parent: Element): string {\n  const maxOrd = Math.max(\n    ...Array.from(parent.children).map(child =>\n      parseInt(child.getAttribute('ord') ?? '-2', 10),\n    ),\n  );\n\n  return isFinite(maxOrd) ? (maxOrd + 1).toString(10) : '0';\n}\n\nfunction createAction(parent: Element): WizardActor {\n  return (inputs: WizardInputElement[]): EditV2[] => {\n    const value = getValue(inputs.find(i => i.label === 'value')!);\n    const desc = getValue(inputs.find(i => i.label === 'desc')!);\n    const ord =\n      getValue(inputs.find(i => i.label === 'ord')!) || nextOrd(parent);\n\n    const element = createElement(parent.ownerDocument, 'EnumVal', {\n      ord,\n      desc,\n    });\n\n    element.textContent = value;\n\n    const action = [\n      {\n        parent,\n        node: element,\n        reference: getReference(parent, 'EnumVal'),\n      },\n    ];\n\n    return [action];\n  };\n}\n\nexport function createEnumValWizard(parent: Element): Wizard {\n  const [ord, desc, value] = [nextOrd(parent), null, ''];\n\n  return {\n    title: 'Add EnumVal',\n    primary: {\n      icon: '',\n      label: 'Save',\n      action: createAction(parent),\n    },\n    content: renderContent({ ord, desc, value }),\n  };\n}\n\nfunction updateAction(element: Element): WizardActor {\n  return (inputs: WizardInputElement[]): EditV2[] => {\n    const value = getValue(inputs.find(i => i.label === 'value')!) ?? '';\n    const desc = getValue(inputs.find(i => i.label === 'desc')!);\n    const ord =\n      getValue(inputs.find(i => i.label === 'ord')!) ||\n      element.getAttribute('ord') ||\n      nextOrd(element.parentElement!);\n\n    if (\n      value === element.textContent &&\n      desc === element.getAttribute('desc') &&\n      ord === element.getAttribute('ord')\n    ) {\n      return [];\n    }\n\n    const newElement = cloneElement(element, { desc, ord });\n    newElement.textContent = value;\n\n    return [\n      {\n        parent: element.parentElement!,\n        node: newElement,\n        reference: getReference(element.parentElement!, 'EnumVal'),\n      },\n      { node: element },\n    ];\n  };\n}\n\nexport function editEnumValWizard(element: Element): Wizard {\n  const [ord, desc, value] = [\n    element.getAttribute('ord'),\n    element.getAttribute('desc'),\n    element.textContent,\n  ];\n\n  return {\n    title: 'Edit EnumVal',\n    primary: {\n      icon: '',\n      label: 'Save',\n      action: updateAction(element),\n    },\n    content: renderContent({ ord, desc, value }),\n  };\n}\n"],"names":["html"],"mappings":"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"}