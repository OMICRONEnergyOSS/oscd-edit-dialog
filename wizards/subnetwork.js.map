{"version":3,"file":"subnetwork.js","sources":["../../../wizards/subnetwork.ts"],"sourcesContent":["import { html, TemplateResult } from 'lit';\n\nimport { EditV2 } from '@omicronenergy/oscd-api';\nimport { getReference } from '@openenergytools/scl-lib';\n\nimport {\n  cloneElement,\n  createElement,\n  getMultiplier,\n  getValue,\n  reservedNames,\n  Wizard,\n  WizardActor,\n  WizardInputElement,\n} from '../foundation.js';\nimport { patterns } from './patterns.js';\n\n/** Initial attribute values suggested for `SubNetwork` creation */\nconst initial = {\n  type: '8-MMS',\n  bitrate: '100',\n  multiplier: 'M',\n};\n\ninterface RenderOptions {\n  name: string | null;\n  reservedValues: string[];\n  desc: string | null;\n  type: string | null;\n  BitRate: string | null;\n  multiplier: string | null;\n}\n\nfunction renderContent(options: RenderOptions): TemplateResult[] {\n  return [\n    html`<scl-text-field\n      label=\"name\"\n      .value=${options.name}\n      required\n      dialogInitialFocus\n    ></scl-text-field>`,\n    html`<scl-text-field\n      label=\"desc\"\n      .value=${options.desc}\n      nullable\n    ></scl-text-field>`,\n    html`<scl-text-field\n      label=\"type\"\n      .value=${options.type}\n      nullable\n      pattern=\"${patterns.normalizedString}\"\n    ></scl-text-field>`,\n    html`<scl-text-field\n      label=\"BitRate\"\n      .value=${options.BitRate}\n      nullable\n      unit=\"b/s\"\n      .multipliers=${[null, 'M']}\n      .multiplier=${options.multiplier}\n      required\n      pattern=\"${patterns.decimal}\"\n    ></scl-text-field>`,\n  ];\n}\n\nexport function createAction(parent: Element): WizardActor {\n  return (inputs: WizardInputElement[]): EditV2[] => {\n    const name = getValue(inputs.find(i => i.label === 'name')!);\n    const desc = getValue(inputs.find(i => i.label === 'desc')!);\n    const type = getValue(inputs.find(i => i.label === 'type')!);\n    const BitRate = getValue(inputs.find(i => i.label === 'BitRate')!);\n    const multiplier = getMultiplier(inputs.find(i => i.label === 'BitRate')!);\n\n    const element = createElement(parent.ownerDocument, 'SubNetwork', {\n      name,\n      desc,\n      type,\n    });\n\n    if (BitRate !== null) {\n      const bitRateElement = createElement(parent.ownerDocument, 'BitRate', {\n        unit: 'b/s',\n        multiplier,\n      });\n      bitRateElement.textContent = BitRate;\n      element.appendChild(bitRateElement);\n    }\n\n    const action = {\n      parent,\n      node: element,\n      reference: getReference(parent, 'SubNetwork'),\n    };\n\n    return [action];\n  };\n}\n\nexport function createSubNetworkWizard(parent: Element): Wizard {\n  return {\n    title: 'Add SubNetwork',\n    primary: {\n      icon: 'add',\n      label: 'add',\n      action: createAction(parent),\n    },\n    content: renderContent({\n      name: '',\n      reservedValues: reservedNames(parent, 'SubNetwork'),\n      desc: '',\n      type: initial.type,\n      BitRate: initial.bitrate,\n      multiplier: initial.multiplier,\n    }),\n  };\n}\n\nfunction getBitRateAction(\n  oldBitRate: Element | null,\n  BitRate: string | null,\n  multiplier: string | null,\n  SubNetwork: Element,\n): EditV2 {\n  if (oldBitRate === null) {\n    const bitRateElement = createElement(SubNetwork.ownerDocument, 'BitRate', {\n      unit: 'b/s',\n    });\n\n    if (multiplier) {\n      bitRateElement.setAttribute('multiplier', multiplier);\n    }\n    if (BitRate) {\n      bitRateElement.textContent = BitRate;\n    }\n\n    return {\n      parent: SubNetwork,\n      node: bitRateElement,\n      reference: getReference(SubNetwork, 'BitRate'),\n    };\n  }\n\n  if (BitRate === null) {\n    return {\n      parent: SubNetwork,\n      node: oldBitRate,\n      reference: oldBitRate.nextSibling,\n    };\n  }\n\n  const newBitRate = cloneElement(oldBitRate, { multiplier });\n  newBitRate.textContent = BitRate;\n\n  return [\n    {\n      parent: oldBitRate.parentElement!,\n      node: newBitRate,\n      reference: getReference(oldBitRate.parentElement!, 'BitRate'),\n    },\n    { node: oldBitRate },\n  ];\n}\n\nfunction updateAction(element: Element): WizardActor {\n  return (inputs: WizardInputElement[]): EditV2[] => {\n    const name = inputs.find(i => i.label === 'name')!.value!;\n    const desc = getValue(inputs.find(i => i.label === 'desc')!);\n    const type = getValue(inputs.find(i => i.label === 'type')!);\n    const BitRate = getValue(inputs.find(i => i.label === 'BitRate')!);\n    const multiplier = getMultiplier(inputs.find(i => i.label === 'BitRate')!);\n\n    let subNetworkAction: EditV2 | null;\n    let bitRateAction: EditV2 | null;\n\n    if (\n      name === element.getAttribute('name') &&\n      desc === element.getAttribute('desc') &&\n      type === element.getAttribute('type')\n    ) {\n      subNetworkAction = null;\n    } else {\n      subNetworkAction = { element, attributes: { name, desc, type } };\n    }\n\n    if (\n      BitRate ===\n        (element.querySelector('SubNetwork > BitRate')?.textContent?.trim() ??\n          null) &&\n      multiplier ===\n        (element\n          .querySelector('SubNetwork > BitRate')\n          ?.getAttribute('multiplier') ?? null)\n    ) {\n      bitRateAction = null;\n    } else {\n      bitRateAction = getBitRateAction(\n        element.querySelector('SubNetwork > BitRate'),\n        BitRate,\n        multiplier,\n        subNetworkAction?.element ?? element,\n      );\n    }\n\n    const actions: EditV2[] = [];\n    if (subNetworkAction) {\n      actions.push(subNetworkAction);\n    }\n    if (bitRateAction) {\n      actions.push(bitRateAction);\n    }\n    return actions;\n  };\n}\n\nexport function editSubNetworkWizard(element: Element): Wizard {\n  const name = element.getAttribute('name');\n  const desc = element.getAttribute('desc');\n  const type = element.getAttribute('type');\n  const BitRate =\n    element.querySelector('SubNetwork > BitRate')?.textContent?.trim() ?? null;\n  const multiplier =\n    element.querySelector('SubNetwork > BitRate')?.getAttribute('multiplier') ??\n    null;\n\n  const reservedValues = reservedNames(element);\n\n  return {\n    title: 'Edit SubNetwork',\n    primary: {\n      icon: 'save',\n      label: 'save',\n      action: updateAction(element),\n    },\n    content: renderContent({\n      name,\n      reservedValues,\n      desc,\n      type,\n      BitRate,\n      multiplier,\n    }),\n  };\n}\n"],"names":["html"],"mappings":"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"}