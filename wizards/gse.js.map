{"version":3,"file":"gse.js","sources":["../../../wizards/gse.ts"],"sourcesContent":["import { html } from 'lit';\n\nimport { EditV2 } from '@openscd/oscd-api';\n\nimport { SclCheckbox } from '@openenergytools/scl-checkbox';\n\nimport { getReference } from '@openscd/scl-lib';\n\nimport {\n  createElement,\n  getValue,\n  Wizard,\n  WizardActor,\n  WizardInputElement,\n} from '../foundation.js';\n\nimport { contentAddress, updateAddress } from './address.js';\n\nfunction mxxTimeUpdateAction(\n  gse: Element,\n  oldMxxTime: Element | null,\n  newTimeValue: string | null,\n  option: {\n    minOrMax: 'MinTime' | 'MaxTime';\n  },\n): EditV2[] {\n  if (oldMxxTime === null) {\n    const newMxxTime = createElement(gse.ownerDocument, option.minOrMax, {\n      unit: 's',\n      multiplier: 'm',\n    });\n    newMxxTime.textContent = newTimeValue;\n    return [\n      {\n        parent: gse,\n        node: newMxxTime,\n        reference: getReference(gse, option.minOrMax),\n      },\n    ];\n  }\n\n  if (newTimeValue === null) {\n    return [\n      {\n        node: oldMxxTime,\n      },\n    ];\n  }\n\n  const newMxxTime = <Element>oldMxxTime.cloneNode(false);\n  newMxxTime.textContent = newTimeValue;\n  return [\n    {\n      parent: gse,\n      node: newMxxTime,\n      reference: oldMxxTime.nextSibling,\n    },\n    { node: oldMxxTime },\n  ];\n}\n\nfunction updateAction(element: Element): WizardActor {\n  return (inputs: WizardInputElement[], wizard: Element): EditV2[] => {\n    const action: EditV2 = [];\n\n    const instType: boolean =\n      (wizard.querySelector('#instType') as SclCheckbox).value === 'true';\n\n    const addressContent: Record<string, string | null> = {};\n    addressContent['MAC-Address'] = getValue(\n      inputs.find(i => i.label === 'MAC-Address')!,\n    );\n    addressContent.APPID = getValue(inputs.find(i => i.label === 'APPID')!);\n    addressContent['VLAN-ID'] = getValue(\n      inputs.find(i => i.label === 'VLAN-ID')!,\n    );\n    addressContent['VLAN-PRIORITY'] = getValue(\n      inputs.find(i => i.label === 'VLAN-PRIORITY')!,\n    );\n\n    const addressActions = updateAddress(element, addressContent, instType);\n\n    addressActions.forEach(addressAction => {\n      action.push(addressAction);\n    });\n\n    const minTime = getValue(inputs.find(i => i.label === 'MinTime')!);\n    const MaxTime = getValue(inputs.find(i => i.label === 'MaxTime')!);\n    if (\n      minTime !==\n      (element.querySelector('MinTime')?.textContent?.trim() ?? null)\n    ) {\n      action.push(\n        ...mxxTimeUpdateAction(\n          element,\n          element.querySelector('MinTime'),\n          minTime,\n          { minOrMax: 'MinTime' },\n        ),\n      );\n    }\n    if (\n      MaxTime !==\n      (element.querySelector('MaxTime')?.textContent?.trim() ?? null)\n    ) {\n      action.push(\n        ...mxxTimeUpdateAction(\n          element,\n          element.querySelector('MaxTime'),\n          minTime,\n          { minOrMax: 'MaxTime' },\n        ),\n      );\n    }\n\n    return action;\n  };\n}\n\nexport function editGseWizard(element: Element): Wizard {\n  const minTime = element.querySelector('MinTime')?.innerHTML.trim() ?? null;\n  const maxTime = element.querySelector('MaxTime')?.innerHTML.trim() ?? null;\n\n  const types = ['MAC-Address', 'APPID', 'VLAN-ID', 'VLAN-PRIORITY'];\n\n  return {\n    title: 'Edit GSE',\n    primary: {\n      label: 'save',\n      icon: 'save',\n      action: updateAction(element),\n    },\n    content: [\n      ...contentAddress({ element, types }),\n      html`<scl-text-field\n        label=\"MinTime\"\n        .value=${minTime}\n        nullable\n        suffix=\"ms\"\n        type=\"number\"\n      ></scl-text-field>`,\n      html`<scl-text-field\n        label=\"MaxTime\"\n        .value=${maxTime}\n        nullable\n        suffix=\"ms\"\n        type=\"number\"\n      ></scl-text-field>`,\n    ],\n  };\n}\n"],"names":["html"],"mappings":"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"}