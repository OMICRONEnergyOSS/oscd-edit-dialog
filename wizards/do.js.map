{"version":3,"file":"do.js","sources":["../../../wizards/do.ts"],"sourcesContent":["import { html, TemplateResult } from 'lit';\n\nimport { EditV2 } from '@openscd/oscd-api';\n\nimport { getReference } from '@openscd/scl-lib';\n\nimport {\n  createElement,\n  getValue,\n  Wizard,\n  WizardActor,\n  WizardInputElement,\n} from '../foundation.js';\nimport { patterns } from './patterns.js';\n\ntype DoContent = {\n  name: string | null;\n  desc: string | null;\n  transient: string | null;\n  accessControl: string | null;\n  type: string | null;\n  doTypes: Element[];\n};\n\nfunction renderContent(content: DoContent): TemplateResult[] {\n  return [\n    html`<scl-text-field\n      label=\"name\"\n      .value=${content.name}\n      required\n      pattern=\"${patterns.alphanumericFirstUpperCase}\"\n      dialogInitialFocus\n    ></scl-text-field>`,\n    html`<scl-text-field\n      label=\"desc\"\n      .value=${content.desc}\n      nullable\n      pattern=\"${patterns.normalizedString}\"\n    ></scl-text-field>`,\n    html`<scl-select\n      label=\"type\"\n      required\n      .selectOptions=${content.doTypes.map(doType => doType.id)}\n      .value=${content.type}\n    ></scl-select>`,\n    html`<scl-text-field\n      label=\"accessControl\"\n      .value=${content.accessControl}\n      nullable\n      pattern=\"${patterns.normalizedString}\"\n    ></scl-text-field>`,\n    html`<scl-checkbox\n      label=\"transient\"\n      .value=\"${content.transient}\"\n      nullable\n    ></scl-checkbox>`,\n  ];\n}\n\nfunction createDoAction(parent: Element): WizardActor {\n  return (inputs: WizardInputElement[]): EditV2[] => {\n    const name = getValue(inputs.find(i => i.label === 'name')!)!;\n    const desc = getValue(inputs.find(i => i.label === 'desc')!);\n    const type = getValue(inputs.find(i => i.label === 'type')!);\n    const accessControl = getValue(\n      inputs.find(i => i.label === 'accessControl')!,\n    );\n    const transient =\n      getValue(inputs.find(i => i.label === 'transient')!) !== ''\n        ? getValue(inputs.find(i => i.label === 'transient')!)\n        : null;\n\n    const actions: EditV2[] = [];\n\n    const element = createElement(parent.ownerDocument, 'DO', {\n      name,\n      desc,\n      type,\n      accessControl,\n      transient,\n    });\n\n    actions.push({\n      parent,\n      node: element,\n      reference: getReference(parent, 'DO'),\n    });\n\n    return actions;\n  };\n}\n\nexport function createDoWizard(parent: Element): Wizard {\n  const [type, name, desc, accessControl, transient] = [\n    null,\n    '',\n    null,\n    null,\n    null,\n  ];\n\n  const doTypes = Array.from(\n    parent.ownerDocument.querySelectorAll('DOType'),\n  ).filter(doType => doType.getAttribute('id'));\n\n  return {\n    title: 'Add DO',\n    primary: { icon: '', label: 'save', action: createDoAction(parent) },\n    content: renderContent({\n      name,\n      desc,\n      transient,\n      accessControl,\n      type,\n      doTypes,\n    }),\n  };\n}\n\nfunction updateDoAction(element: Element): WizardActor {\n  return (inputs: WizardInputElement[]): EditV2[] => {\n    const name = getValue(inputs.find(i => i.label === 'name')!)!;\n    const desc = getValue(inputs.find(i => i.label === 'desc')!);\n    const type = getValue(inputs.find(i => i.label === 'type')!)!;\n    const accessControl = getValue(\n      inputs.find(i => i.label === 'accessControl')!,\n    );\n    const transient =\n      getValue(inputs.find(i => i.label === 'transient')!) !== ''\n        ? getValue(inputs.find(i => i.label === 'transient')!)\n        : null;\n\n    if (\n      name === element.getAttribute('name') &&\n      desc === element.getAttribute('desc') &&\n      type === element.getAttribute('type') &&\n      accessControl === element.getAttribute('accessControl') &&\n      transient === element.getAttribute('transient')\n    ) {\n      return [];\n    }\n\n    return [\n      { element, attributes: { name, desc, type, accessControl, transient } },\n    ];\n  };\n}\n\nexport function editDoWizard(element: Element): Wizard {\n  const [type, name, desc, accessControl, transient] = [\n    element.getAttribute('type'),\n    element.getAttribute('name'),\n    element.getAttribute('desc'),\n    element.getAttribute('accessControl'),\n    element.getAttribute('transient'),\n  ];\n\n  const doTypes = Array.from(\n    element.ownerDocument.querySelectorAll('DOType'),\n  ).filter(doType => doType.getAttribute('id'));\n\n  return {\n    title: 'Edit DO',\n    primary: { icon: '', label: 'save', action: updateDoAction(element) },\n    content: renderContent({\n      name,\n      desc,\n      transient,\n      accessControl,\n      type,\n      doTypes,\n    }),\n  };\n}\n"],"names":["html"],"mappings":";;;;;;;;;;;;;;AAwBA,SAAS,aAAa,CAAC,OAAkB,EAAA;IACvC,OAAO;AACL,QAAAA,CAAI,CAAA,CAAA;;AAEO,aAAA,EAAA,OAAO,CAAC,IAAI;;AAEV,eAAA,EAAA,QAAQ,CAAC,0BAA0B,CAAA;;AAE7B,sBAAA,CAAA;AACnB,QAAAA,CAAI,CAAA,CAAA;;AAEO,aAAA,EAAA,OAAO,CAAC,IAAI;;AAEV,eAAA,EAAA,QAAQ,CAAC,gBAAgB,CAAA;AACnB,sBAAA,CAAA;AACnB,QAAAA,CAAI,CAAA,CAAA;;;AAGe,qBAAA,EAAA,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,MAAM,IAAI,MAAM,CAAC,EAAE,CAAC;AAChD,aAAA,EAAA,OAAO,CAAC,IAAI;AACR,kBAAA,CAAA;AACf,QAAAA,CAAI,CAAA,CAAA;;AAEO,aAAA,EAAA,OAAO,CAAC,aAAa;;AAEnB,eAAA,EAAA,QAAQ,CAAC,gBAAgB,CAAA;AACnB,sBAAA,CAAA;AACnB,QAAAA,CAAI,CAAA,CAAA;;AAEQ,cAAA,EAAA,OAAO,CAAC,SAAS,CAAA;;AAEZ,oBAAA,CAAA;KAClB;AACH;AAEA,SAAS,cAAc,CAAC,MAAe,EAAA;IACrC,OAAO,CAAC,MAA4B,KAAc;AAChD,QAAA,MAAM,IAAI,GAAG,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,KAAK,MAAM,CAAE,CAAE;AAC7D,QAAA,MAAM,IAAI,GAAG,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,KAAK,MAAM,CAAE,CAAC;AAC5D,QAAA,MAAM,IAAI,GAAG,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,KAAK,MAAM,CAAE,CAAC;AAC5D,QAAA,MAAM,aAAa,GAAG,QAAQ,CAC5B,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,KAAK,eAAe,CAAE,CAC/C;QACD,MAAM,SAAS,GACb,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,KAAK,WAAW,CAAE,CAAC,KAAK;AACvD,cAAE,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,KAAK,WAAW,CAAE;cACnD,IAAI;QAEV,MAAM,OAAO,GAAa,EAAE;QAE5B,MAAM,OAAO,GAAG,aAAa,CAAC,MAAM,CAAC,aAAa,EAAE,IAAI,EAAE;YACxD,IAAI;YACJ,IAAI;YACJ,IAAI;YACJ,aAAa;YACb,SAAS;AACV,SAAA,CAAC;QAEF,OAAO,CAAC,IAAI,CAAC;YACX,MAAM;AACN,YAAA,IAAI,EAAE,OAAO;AACb,YAAA,SAAS,EAAE,YAAY,CAAC,MAAM,EAAE,IAAI,CAAC;AACtC,SAAA,CAAC;AAEF,QAAA,OAAO,OAAO;AAChB,IAAA,CAAC;AACH;AAEM,SAAU,cAAc,CAAC,MAAe,EAAA;IAC5C,MAAM,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,aAAa,EAAE,SAAS,CAAC,GAAG;QACnD,IAAI;QACJ,EAAE;QACF,IAAI;QACJ,IAAI;QACJ,IAAI;KACL;AAED,IAAA,MAAM,OAAO,GAAG,KAAK,CAAC,IAAI,CACxB,MAAM,CAAC,aAAa,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAChD,CAAC,MAAM,CAAC,MAAM,IAAI,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;IAE7C,OAAO;AACL,QAAA,KAAK,EAAE,QAAQ;AACf,QAAA,OAAO,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE,cAAc,CAAC,MAAM,CAAC,EAAE;QACpE,OAAO,EAAE,aAAa,CAAC;YACrB,IAAI;YACJ,IAAI;YACJ,SAAS;YACT,aAAa;YACb,IAAI;YACJ,OAAO;SACR,CAAC;KACH;AACH;AAEA,SAAS,cAAc,CAAC,OAAgB,EAAA;IACtC,OAAO,CAAC,MAA4B,KAAc;AAChD,QAAA,MAAM,IAAI,GAAG,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,KAAK,MAAM,CAAE,CAAE;AAC7D,QAAA,MAAM,IAAI,GAAG,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,KAAK,MAAM,CAAE,CAAC;AAC5D,QAAA,MAAM,IAAI,GAAG,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,KAAK,MAAM,CAAE,CAAE;AAC7D,QAAA,MAAM,aAAa,GAAG,QAAQ,CAC5B,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,KAAK,eAAe,CAAE,CAC/C;QACD,MAAM,SAAS,GACb,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,KAAK,WAAW,CAAE,CAAC,KAAK;AACvD,cAAE,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,KAAK,WAAW,CAAE;cACnD,IAAI;AAEV,QAAA,IACE,IAAI,KAAK,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC;AACrC,YAAA,IAAI,KAAK,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC;AACrC,YAAA,IAAI,KAAK,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC;AACrC,YAAA,aAAa,KAAK,OAAO,CAAC,YAAY,CAAC,eAAe,CAAC;YACvD,SAAS,KAAK,OAAO,CAAC,YAAY,CAAC,WAAW,CAAC,EAC/C;AACA,YAAA,OAAO,EAAE;QACX;QAEA,OAAO;AACL,YAAA,EAAE,OAAO,EAAE,UAAU,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,aAAa,EAAE,SAAS,EAAE,EAAE;SACxE;AACH,IAAA,CAAC;AACH;AAEM,SAAU,YAAY,CAAC,OAAgB,EAAA;IAC3C,MAAM,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,aAAa,EAAE,SAAS,CAAC,GAAG;AACnD,QAAA,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC;AAC5B,QAAA,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC;AAC5B,QAAA,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC;AAC5B,QAAA,OAAO,CAAC,YAAY,CAAC,eAAe,CAAC;AACrC,QAAA,OAAO,CAAC,YAAY,CAAC,WAAW,CAAC;KAClC;AAED,IAAA,MAAM,OAAO,GAAG,KAAK,CAAC,IAAI,CACxB,OAAO,CAAC,aAAa,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CACjD,CAAC,MAAM,CAAC,MAAM,IAAI,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;IAE7C,OAAO;AACL,QAAA,KAAK,EAAE,SAAS;AAChB,QAAA,OAAO,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE,cAAc,CAAC,OAAO,CAAC,EAAE;QACrE,OAAO,EAAE,aAAa,CAAC;YACrB,IAAI;YACJ,IAAI;YACJ,SAAS;YACT,aAAa;YACb,IAAI;YACJ,OAAO;SACR,CAAC;KACH;AACH;;;;"}