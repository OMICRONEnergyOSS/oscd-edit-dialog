{"version":3,"file":"voltagelevel.js","sources":["../../../wizards/voltagelevel.ts"],"sourcesContent":["import { html, TemplateResult } from 'lit';\n\nimport { EditV2 } from '@omicronenergy/oscd-api';\n\nimport {\n  getReference,\n  Update as OldUpdate,\n  updateVoltageLevel,\n} from '@openenergytools/scl-lib';\n\nimport {\n  cloneElement,\n  createElement,\n  getMultiplier,\n  getValue,\n  reservedNames,\n  Wizard,\n  WizardActor,\n  WizardInputElement,\n} from '../foundation.js';\n\nconst initial = {\n  nomFreq: '50',\n  numPhases: '3',\n  Voltage: '110',\n  multiplier: 'k',\n};\n\ntype RenderOptions = {\n  name: string;\n  reservedValues: string[];\n  desc: string | null;\n  nomFreq: string | null;\n  numPhases: string | null;\n  Voltage: string | null;\n  multiplier: string | null;\n};\n\nfunction render(option: RenderOptions): TemplateResult[] {\n  return [\n    html`<scl-text-field\n      label=\"name\"\n      .value=${option.name}\n      helper=\"VoltageLevel name attribute\"\n      required\n      validationMessage=\"Required information\"\n      .reservedValues=\"${option.reservedValues}\"\n      dialogInitialFocus\n    ></scl-text-field>`,\n    html`<scl-text-field\n      label=\"desc\"\n      .value=${option.desc}\n      nullable\n      helper=\"VoltageLevel name attribute\"\n    ></scl-text-field>`,\n    html`<scl-text-field\n      label=\"nomFreq\"\n      .value=${option.nomFreq}\n      nullable\n      helper=\"Nominal Frequency\"\n      suffix=\"Hz\"\n      required\n      validationMessage=\"Number bigger than 0\"\n    ></scl-text-field>`,\n    html`<scl-text-field\n      label=\"numPhases\"\n      .value=${option.numPhases}\n      nullable\n      helper=\"Number of Phases\"\n      suffix=\"#\"\n      required\n      validationMessage=\"Number bigger than 0\"\n      type=\"number\"\n      min=\"1\"\n      max=\"255\"\n    ></scl-text-field>`,\n    html`<scl-text-field\n      label=\"Voltage\"\n      .value=${option.Voltage}\n      nullable\n      unit=\"V\"\n      .multipliers=${[null, 'G', 'M', 'k', '', 'm']}\n      .multiplier=${option.multiplier}\n      helper=\"Voltage\"\n      required\n      validationMessage=\"Number bigger than 0\"\n    ></scl-text-field>`,\n  ];\n}\n\nexport function createAction(parent: Element): WizardActor {\n  return (inputs: WizardInputElement[]): EditV2[] => {\n    const name = getValue(inputs.find(i => i.label === 'name')!);\n    const desc = getValue(inputs.find(i => i.label === 'desc')!);\n    const nomFreq = getValue(inputs.find(i => i.label === 'nomFreq')!);\n    const numPhases = getValue(inputs.find(i => i.label === 'numPhases')!);\n    const Voltage = getValue(inputs.find(i => i.label === 'Voltage')!);\n    const multiplier = getMultiplier(inputs.find(i => i.label === 'Voltage')!);\n\n    const element = createElement(parent.ownerDocument, 'VoltageLevel', {\n      name,\n      desc,\n      nomFreq,\n      numPhases,\n    });\n\n    if (Voltage !== null) {\n      const voltageElement = createElement(parent.ownerDocument, 'Voltage', {\n        unit: 'V',\n        multiplier,\n      });\n      voltageElement.textContent = Voltage;\n      element.insertBefore(voltageElement, element.firstChild);\n    }\n\n    return [\n      {\n        parent,\n        node: element,\n        reference: getReference(parent, 'VoltageLevel'),\n      },\n    ];\n  };\n}\n\nexport function createVoltageLevelWizard(parent: Element): Wizard {\n  return {\n    title: 'Create VoltageLevel',\n    primary: {\n      icon: 'add',\n      label: 'add',\n      action: createAction(parent),\n    },\n    content: render({\n      name: '',\n      reservedValues: reservedNames(parent, 'VoltageLevel'),\n      desc: '',\n      nomFreq: initial.nomFreq,\n      numPhases: initial.numPhases,\n      Voltage: initial.Voltage,\n      multiplier: initial.multiplier,\n    }),\n  };\n}\n\nfunction getVoltageAction(\n  oldVoltage: Element | null,\n  Voltage: string | null,\n  multiplier: string | null,\n  voltageLevel: Element,\n): EditV2[] {\n  if (oldVoltage === null) {\n    const element = createElement(voltageLevel.ownerDocument, 'Voltage', {\n      unit: 'V',\n      multiplier,\n    });\n    element.textContent = Voltage;\n    return [\n      {\n        parent: voltageLevel,\n        node: element,\n        reference: getReference(voltageLevel, 'Voltage'),\n      },\n    ];\n  }\n\n  if (Voltage === null) {\n    return [\n      {\n        node: oldVoltage,\n      },\n    ];\n  }\n\n  const newVoltage = cloneElement(oldVoltage, { multiplier });\n  newVoltage.textContent = Voltage;\n\n  return [\n    {\n      parent: voltageLevel,\n      node: newVoltage,\n      reference: oldVoltage.nextElementSibling,\n    },\n    { node: oldVoltage },\n  ];\n}\n\nexport function updateAction(element: Element): WizardActor {\n  return (inputs: WizardInputElement[]): EditV2[] => {\n    const name = inputs.find(i => i.label === 'name')!.value!;\n    const desc = getValue(inputs.find(i => i.label === 'desc')!);\n    const nomFreq = getValue(inputs.find(i => i.label === 'nomFreq')!);\n    const numPhases = getValue(inputs.find(i => i.label === 'numPhases')!);\n    const Voltage = getValue(inputs.find(i => i.label === 'Voltage')!);\n    const multiplier = getMultiplier(inputs.find(i => i.label === 'Voltage')!);\n\n    let voltageLevelAction: OldUpdate | null;\n    let voltageAction: EditV2 | null;\n\n    if (\n      name === element.getAttribute('name') &&\n      desc === element.getAttribute('desc') &&\n      nomFreq === element.getAttribute('nomFreq') &&\n      numPhases === element.getAttribute('numPhases')\n    ) {\n      voltageLevelAction = null;\n    } else {\n      voltageLevelAction = {\n        element,\n        attributes: { name, desc, nomFreq, numPhases },\n      };\n    }\n\n    if (\n      Voltage ===\n        (element.querySelector('VoltageLevel > Voltage')?.textContent?.trim() ??\n          null) &&\n      multiplier ===\n        (element\n          .querySelector('VoltageLevel > Voltage')\n          ?.getAttribute('multiplier') ?? null)\n    ) {\n      voltageAction = null;\n    } else {\n      voltageAction = getVoltageAction(\n        element.querySelector('VoltageLevel > Voltage'),\n        Voltage,\n        multiplier,\n        element,\n      );\n    }\n\n    const complexAction: EditV2[] = [];\n    if (voltageLevelAction) {\n      complexAction.push(\n        ...updateVoltageLevel(voltageLevelAction as OldUpdate),\n      );\n    }\n    if (voltageAction) {\n      complexAction.push(...voltageAction);\n    }\n    return complexAction.length ? complexAction : [];\n  };\n}\n\nexport function editVoltageLevelWizard(element: Element): Wizard {\n  return {\n    title: 'Edit VoltageLevel',\n    primary: {\n      icon: 'edit',\n      label: 'save',\n      action: updateAction(element),\n    },\n    content: render({\n      name: element.getAttribute('name') ?? '',\n      reservedValues: reservedNames(element),\n      desc: element.getAttribute('desc'),\n      nomFreq: element.getAttribute('nomFreq'),\n      numPhases: element.getAttribute('numPhases'),\n      Voltage:\n        element.querySelector('VoltageLevel > Voltage')?.textContent?.trim() ??\n        null,\n      multiplier:\n        element\n          .querySelector('VoltageLevel > Voltage')\n          ?.getAttribute('multiplier') ?? null,\n    }),\n  };\n}\n"],"names":["html"],"mappings":"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"}