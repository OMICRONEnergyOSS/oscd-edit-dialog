{"version":3,"file":"bda.js","sources":["../../../wizards/bda.ts"],"sourcesContent":["import { EditV2 } from '@omicronenergy/oscd-api';\n\nimport { getReference } from '@openenergytools/scl-lib';\n\nimport {\n  createElement,\n  getValue,\n  Wizard,\n  WizardActor,\n  WizardInputElement,\n} from '../foundation.js';\n\nimport {\n  getValAction,\n  renderAbstractDataAttributeContent,\n} from './abstractda.js';\n\nfunction createBDaAction(parent: Element): WizardActor {\n  return (inputs: WizardInputElement[]): EditV2[] => {\n    const name = getValue(inputs.find(i => i.label === 'name')!)!;\n    const desc = getValue(inputs.find(i => i.label === 'desc')!);\n    const bType = getValue(inputs.find(i => i.label === 'bType')!)!;\n    const type =\n      bType === 'Enum' || bType === 'Struct'\n        ? getValue(inputs.find(i => i.label === 'type')!)\n        : null;\n    const sAddr = getValue(inputs.find(i => i.label === 'sAddr')!);\n    const valKind =\n      getValue(inputs.find(i => i.label === 'valKind')!) !== ''\n        ? getValue(inputs.find(i => i.label === 'valKind')!)\n        : null;\n    const valImport =\n      getValue(inputs.find(i => i.label === 'valImport')!) !== ''\n        ? getValue(inputs.find(i => i.label === 'valImport')!)\n        : null;\n\n    const valField = inputs.find(\n      i => i.label === 'Val' && i.style.display !== 'none',\n    );\n    const Val = valField ? getValue(valField) : null;\n\n    const element = createElement(parent.ownerDocument, 'BDA', {\n      name,\n      desc,\n      bType,\n      type,\n      sAddr,\n      valKind,\n      valImport,\n    });\n\n    if (Val !== null) {\n      const valElement = createElement(parent.ownerDocument, 'Val', {});\n      valElement.textContent = Val;\n      element.appendChild(valElement);\n    }\n\n    return [\n      {\n        parent,\n        node: element,\n        reference: getReference(parent, 'BDA'),\n      },\n    ];\n  };\n}\n\nexport function createBDaWizard(element: Element): Wizard {\n  const doc = element.ownerDocument;\n\n  const name = '';\n  const desc = null;\n  const bType = '';\n  const type = null;\n  const sAddr = null;\n  const Val = null;\n  const valKind = null;\n  const valImport = null;\n\n  const doOrEnumTypes = Array.from(\n    doc.querySelectorAll('DAType, EnumType'),\n  ).filter(doOrEnumType => doOrEnumType.getAttribute('id'));\n\n  const data = element.closest('DataTypeTemplates')!;\n\n  return {\n    title: 'Add BDA',\n    primary: {\n      icon: '',\n      label: 'save',\n      action: createBDaAction(element),\n    },\n    content: [\n      ...renderAbstractDataAttributeContent(\n        name,\n        desc,\n        bType,\n        doOrEnumTypes,\n        type,\n        sAddr,\n        valKind,\n        valImport,\n        Val,\n        data,\n      ),\n    ],\n  };\n}\n\nfunction updateBDaAction(element: Element): WizardActor {\n  return (inputs: WizardInputElement[]): EditV2[] => {\n    const name = getValue(inputs.find(i => i.label === 'name')!)!;\n    const desc = getValue(inputs.find(i => i.label === 'desc')!);\n    const bType = getValue(inputs.find(i => i.label === 'bType')!)!;\n    const type =\n      bType === 'Enum' || bType === 'Struct'\n        ? getValue(inputs.find(i => i.label === 'type')!)\n        : null;\n    const sAddr = getValue(inputs.find(i => i.label === 'sAddr')!);\n    const valKind = getValue(inputs.find(i => i.label === 'valKind')!);\n    const valImport = getValue(inputs.find(i => i.label === 'valImport')!);\n    const valField = inputs.find(\n      i => i.label === 'Val' && i.style.display !== 'none',\n    );\n    const Val = valField ? getValue(valField) : null;\n\n    let bdaAction: EditV2 | null;\n    const valAction: EditV2 = [];\n\n    if (\n      name === element.getAttribute('name') &&\n      desc === element.getAttribute('desc') &&\n      bType === element.getAttribute('bType') &&\n      type === element.getAttribute('type') &&\n      sAddr === element.getAttribute('sAddr') &&\n      valKind === element.getAttribute('valKind') &&\n      valImport === element.getAttribute('valImprot')\n    ) {\n      bdaAction = null;\n    } else {\n      bdaAction = {\n        element,\n        attributes: {\n          name,\n          desc,\n          bType,\n          type,\n          sAddr,\n          valKind,\n          valImport,\n        },\n      };\n    }\n\n    if (Val !== (element.querySelector('Val')?.textContent?.trim() ?? null)) {\n      valAction.push(\n        getValAction(\n          element.querySelector('Val'),\n          Val,\n          bdaAction?.element ?? element,\n        ),\n      );\n    }\n\n    const actions: EditV2[] = [];\n    if (bdaAction) {\n      actions.push(bdaAction);\n    }\n    if (valAction) {\n      actions.push(...valAction);\n    }\n    return actions;\n  };\n}\n\nexport function editBDaWizard(element: Element): Wizard {\n  const doc = element.ownerDocument;\n  const type = element.getAttribute('type');\n  const name = element.getAttribute('name');\n  const desc = element.getAttribute('desc');\n  const bType = element.getAttribute('bType') ?? '';\n  const sAddr = element.getAttribute('sAddr');\n  const Val = element.querySelector('Val')?.innerHTML.trim() ?? null;\n  const valKind = element.getAttribute('valKind');\n  const valImport = element.getAttribute('valImport');\n\n  const daOrEnumTypes = Array.from(\n    doc.querySelectorAll('DAType, EnumType'),\n  ).filter(daOrEnumType => daOrEnumType.getAttribute('id'));\n\n  const data = element.closest('DataTypeTemplates')!;\n\n  return {\n    title: 'Edit BDA',\n    primary: {\n      icon: '',\n      label: 'save',\n      action: updateBDaAction(element),\n    },\n    content: [\n      ...renderAbstractDataAttributeContent(\n        name,\n        desc,\n        bType,\n        daOrEnumTypes,\n        type,\n        sAddr,\n        valKind,\n        valImport,\n        Val,\n        data,\n      ),\n    ],\n  };\n}\n"],"names":[],"mappings":"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"}