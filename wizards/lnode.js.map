{"version":3,"file":"lnode.js","sources":["../../../wizards/lnode.ts"],"sourcesContent":["import { html, TemplateResult } from 'lit';\n\nimport {\n  SelectionList,\n  SelectItem,\n} from '@openenergytools/filterable-lists/dist/SelectionList.js';\nimport { MdList } from '@scopedelement/material-web/list/MdList.js';\nimport { MdListItem } from '@scopedelement/material-web/list/MdListItem.js';\n\nimport { EditV2, Insert } from '@omicronenergy/oscd-api';\n\nimport { getReference, lnInstGenerator } from '@openenergytools/scl-lib';\n\nimport {\n  createElement,\n  Wizard,\n  WizardActor,\n  WizardInputElement,\n} from '../foundation.js';\n\ntype LNodeCandidate = {\n  anyLn: Element;\n  existInScope: boolean;\n  existOutOfScope: boolean;\n};\n\n// global variables\nconst selectedIEDs: Element[] = [];\nlet isLogicalNodeInstance = true;\nlet isIedListVisable = true;\n\nfunction lNodeItems(doc: XMLDocument): SelectItem[] {\n  return Array.from(\n    doc.querySelectorAll(':root > DataTypeTemplates > LNodeType'),\n  ).map(lNodeType => {\n    const lnClass = lNodeType.getAttribute('lnClass');\n    const id = lNodeType.getAttribute('id');\n\n    return {\n      headline: `${lnClass}`,\n      supportingText: `#${id}`,\n      attachedElement: lNodeType,\n      selected: false,\n      disabled: false,\n    };\n  });\n}\n\nfunction anyLnAttrs(anyLn: Element): {\n  prefix: string;\n  lnClass: string;\n  inst: string;\n  iedName: string;\n  ldInst: string;\n  lnType: string;\n} {\n  const prefix = anyLn.getAttribute('prefix') ?? '';\n  const lnClass = anyLn.getAttribute('lnClass') ?? '';\n  const inst = anyLn.getAttribute('inst') ?? '';\n  const lnType = anyLn.getAttribute('lnType') ?? '';\n\n  const iedName = anyLn.closest('IED')?.getAttribute('name') ?? '';\n  const ldInst = anyLn.closest('LDevice')?.getAttribute('inst') ?? '';\n\n  return { prefix, lnClass, inst, iedName, ldInst, lnType };\n}\n\nfunction createSelectedItem(lNode: LNodeCandidate): SelectItem {\n  const { iedName, ldInst, prefix, lnClass, inst } = anyLnAttrs(lNode.anyLn);\n\n  return {\n    headline: `${prefix}${lnClass}${inst}`,\n    supportingText: `${iedName} | ${ldInst}`,\n    attachedElement: lNode.anyLn,\n    selected: lNode.existInScope,\n    disabled: lNode.existOutOfScope || lNode.existInScope,\n  };\n}\n\nfunction compare(\n  a: { anyLn: Element; existOutOfScope: boolean; existInScope: boolean },\n  b: { anyLn: Element; existOutOfScope: boolean; existInScope: boolean },\n): number {\n  if (a.existInScope !== b.existInScope) {\n    return a.existInScope ? -1 : 1;\n  }\n\n  if (a.existOutOfScope !== b.existOutOfScope) {\n    return b.existOutOfScope ? -1 : 1;\n  }\n\n  return 0;\n}\n\nfunction lNodeCandidates(parent: Element, anyLn: Element): LNodeCandidate {\n  const { iedName, ldInst, prefix, lnClass, inst } = anyLnAttrs(anyLn);\n\n  // const title = `${prefix}${lnClass}${inst}`;\n\n  const lNode = Array.from(\n    parent.closest('Substation')?.querySelectorAll('LNode') ?? [],\n  ).find(child => {\n    if (child.tagName !== 'LNode') {\n      return false;\n    }\n    return (\n      child.getAttribute('iedName') === iedName &&\n      child.getAttribute('ldInst') === ldInst &&\n      (child.getAttribute('prefix') ?? '') === prefix &&\n      child.getAttribute('lnClass') === lnClass &&\n      (child.getAttribute('lnInst') ?? '') === inst\n    );\n  });\n\n  const existInScope = !!lNode && lNode.parentElement === parent;\n  const existOutOfScope = !!lNode && lNode.parentElement !== parent;\n\n  return { anyLn, existInScope, existOutOfScope };\n}\n\nfunction anyLnItems(parent: Element): SelectItem[] {\n  const ldSelector = ':scope > AccessPoint > Server > LDevice';\n\n  return selectedIEDs.flatMap(ied => {\n    const anyLns = ied.querySelectorAll(\n      `${ldSelector} > LN0, ${ldSelector} > LN`,\n    )!;\n\n    return Array.from(anyLns)\n      .map(anyLn => lNodeCandidates(parent, anyLn))\n      .sort(compare)\n      .map(createSelectedItem);\n  });\n}\n\nfunction lNodeList(target: HTMLElement): SelectionList {\n  return target\n    .closest('#createLNodeWizardContent')\n    ?.querySelector('#lnList') as SelectionList;\n}\n\nfunction iedContainer(target: HTMLElement): Element {\n  return target\n    .closest('#createLNodeWizardContent')\n    ?.querySelector('#iedContainer') as Element;\n}\n\nfunction showLogicalNodeTypes(evt: Event, parent: Element): void {\n  isLogicalNodeInstance = !isLogicalNodeInstance;\n\n  const target = evt.target as HTMLElement;\n\n  if (isLogicalNodeInstance) {\n    iedContainer(target).classList.remove('hidden');\n  } else {\n    iedContainer(target).classList.add('hidden');\n  }\n\n  const items = isLogicalNodeInstance\n    ? anyLnItems(parent)\n    : lNodeItems(parent.ownerDocument);\n\n  lNodeList(target).items = []; // reset for better update performance\n  lNodeList(target).items = items;\n}\n\nfunction addIED(evt: Event, ied: Element, sclParent: Element): void {\n  const target = evt.target as HTMLElement;\n  if (selectedIEDs.includes(ied)) {\n    const index = selectedIEDs.indexOf(ied);\n    selectedIEDs.splice(index, 1);\n    // Updated list items\n    (target.closest('md-list-item') as MdListItem).activated = false;\n  } else {\n    selectedIEDs.push(ied);\n    // Updated list items\n    (target.closest('md-list-item') as MdListItem).activated = true;\n  }\n\n  lNodeList(target).items = [];\n  lNodeList(target).items = anyLnItems(sclParent);\n}\n\nfunction renderIEDItems(parent: Element): TemplateResult[] {\n  const doc = parent.ownerDocument;\n\n  return Array.from(doc.querySelectorAll(':root > IED')).map(ied => {\n    const [iedName, manufacturer] = ['name', 'manufacturer'].map(value =>\n      ied.getAttribute(value),\n    );\n\n    return html`<md-list-item\n      .activated=${selectedIEDs.includes(ied)}\n      type=\"button\"\n      @click=\"${(evt: Event) => {\n        addIED(evt, ied, parent);\n      }}\"\n    >\n      <div slot=\"headline\">${iedName ?? 'unknown IED'}</div>\n      <div slot=\"supporting-text\">\n        ${manufacturer ?? 'unknown manufacturer'}\n      </div>\n    </md-list-item>`;\n  });\n}\n\nfunction showIEdFilterList(evt: Event): void {\n  isIedListVisable = !isIedListVisable;\n\n  const ieds = (evt.target as HTMLElement)\n    .closest('#createLNodeWizardContent')\n    ?.querySelector('#iedList') as MdList;\n\n  if (!isIedListVisable) {\n    ieds.classList.remove('hidden');\n  } else {\n    ieds.classList.add('hidden');\n  }\n}\n\nfunction createAction(parent: Element): WizardActor {\n  function createSingleLNode(lNode: Element): Insert | null {\n    if (lNode.tagName === 'LNodeType') {\n      const lnClass = lNode.getAttribute('lnClass');\n      if (!lnClass) {\n        return null;\n      }\n\n      const lnType = lNode.getAttribute('id');\n      const lnInst = lnInstGenerator(parent, 'LNode')(lnClass);\n      if (!lnInst) {\n        return null;\n      }\n\n      const node = createElement(parent.ownerDocument, 'LNode', {\n        iedName: 'None',\n        lnClass,\n        lnInst,\n        lnType,\n      });\n\n      return {\n        parent,\n        node,\n        reference: getReference(parent, 'LNode'),\n      };\n    }\n\n    const { iedName, ldInst, prefix, lnClass, inst, lnType } =\n      anyLnAttrs(lNode);\n    const node = createElement(parent.ownerDocument, 'LNode', {\n      iedName,\n      ldInst,\n      prefix,\n      lnClass,\n      lnInst: inst,\n      lnType,\n    });\n\n    return {\n      parent,\n      node,\n      reference: getReference(parent, 'LNode'),\n    };\n  }\n\n  return (_: WizardInputElement[], wizard: Element): EditV2[] => {\n    const list = wizard.querySelector('#lnList') as SelectionList;\n\n    const selectedLNs = list.items\n      .filter(item => item.selected)\n      .filter(item => !item.disabled)\n      .map(item => item.attachedElement!);\n\n    return selectedLNs\n      .map(lNode => createSingleLNode(lNode))\n      .filter(insert => insert) as Insert[];\n  };\n}\n\nexport function createLNodeWizard(parent: Element): Wizard {\n  // const iedNames = Array.from(parent.children)\n  //   .filter(child => child.tagName === 'LNode' && child.getAttribute('iedName'))\n  //   .map(lNode => lNode.getAttribute('iedName')!);\n\n  return {\n    title: 'Add LNode',\n    primary: {\n      icon: 'save',\n      label: 'save',\n      action: createAction(parent),\n    },\n    content: [\n      html`<div id=\"createLNodeWizardContent\" style=\"min-height: fit-content;\">\n        <style>\n          .hidden {\n            display: none;\n          }\n        </style>\n        <div\n          id=\"radioContainer\"\n          style=\"display: flex; align-items: center; gap: 16px;\"\n        >\n          <label\n            style=\"display: flex; align-items: center; cursor: pointer; font-size: 14px;\"\n          >\n            <input\n              type=\"radio\"\n              name=\"nodeType\"\n              value=\"type\"\n              style=\"margin-right: 8px; cursor: pointer;\"\n              @change=\"${(evt: Event) => showLogicalNodeTypes(evt, parent)}\"\n              checked\n            />\n            Logical Node Type\n          </label>\n          <label\n            style=\"display: flex; align-items: center; cursor: pointer; font-size: 14px;\"\n          >\n            <input\n              type=\"radio\"\n              name=\"nodeType\"\n              value=\"instance\"\n              style=\"margin-right: 8px; cursor: pointer;\"\n              @change=\"${(evt: Event) => showLogicalNodeTypes(evt, parent)}\"\n            />\n            Logical Node Instance\n          </label>\n        </div>\n        <div style=\"display: flex; flex-direction: row;\">\n          <div id=\"iedContainer\">\n            s\n            <div\n              id=\"iedFilterButton\"\n              tabindex=\"0\"\n              style=\"cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 4px; border: 1px solid #ccc; border-radius: 4px; margin-top: 20px;\"\n              @click=\"${showIEdFilterList}\"\n              @keydown=\"${(evt: KeyboardEvent) => {\n                if (evt.key === 'Enter' || evt.key === ' ') {\n                  evt.preventDefault();\n                  showIEdFilterList(evt);\n                }\n              }}\"\n            >\n              <md-icon>filter_list</md-icon>\n            </div>\n            <md-list id=\"iedList\"> ${renderIEDItems(parent)} </md-list>\n          </div>\n          <selection-list\n            id=\"lnList\"\n            multi\n            .items=${anyLnItems(parent)}\n            filterable\n          ></selection-list>\n        </div>\n      </div>`,\n    ],\n  };\n}\n"],"names":["html"],"mappings":"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"}